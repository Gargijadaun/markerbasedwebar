<!DOCTYPE html>
<html>
<head>
  <title>Image Target with Three.js</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const targetImage = new Image();
    targetImage.src = './jothisir.jpg'; // Replace with your image path

    const cube = new THREE.Mesh(
      new THREE.BoxGeometry(),
      new THREE.MeshBasicMaterial({ color: 0x00ff00 })
    );
    scene.add(cube);
    cube.visible = false; // Initially hide the cube

    const video = document.createElement('video');
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');

    const constraints = { video: { facingMode: 'environment' } };

    navigator.mediaDevices.getUserMedia(constraints)
      .then((stream) => {
        video.srcObject = stream;
        video.play();
        video.onloadedmetadata = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          detectImage();
        };
      })
      .catch((error) => {
        console.error('Error accessing camera:', error);
      });

    function detectImage() {
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);

      const targetImageData = context.createImageData(canvas.width, canvas.height);
      targetImageData.data.set(imageData.data);

      const targetCanvas = document.createElement('canvas');
      targetCanvas.width = targetImage.width;
      targetCanvas.height = targetImage.height;
      const targetContext = targetCanvas.getContext('2d');
      targetContext.drawImage(targetImage, 0, 0);

      const targetImageDataArray = new Uint8ClampedArray(targetImageData.data.buffer);

      for (let i = 0; i < imageData.data.length; i += 4) {
        const rDiff = Math.abs(targetImageDataArray[i] - imageData.data[i]);
        const gDiff = Math.abs(targetImageDataArray[i + 1] - imageData.data[i + 1]);
        const bDiff = Math.abs(targetImageDataArray[i + 2] - imageData.data[i + 2]);
        
        if (rDiff + gDiff + bDiff < 100) {
          cube.visible = true; // Show the cube if the image is detected
          break;
        }
      }

      renderer.render(scene, camera);
      requestAnimationFrame(detectImage);
    }

    camera.position.z = 5;

    function animate() {
      requestAnimationFrame(animate);
      cube.rotation.x += 0.01;
      cube.rotation.y += 0.01;
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
